# рџЋ‰ Invoice4U Integration - Ч”Ч¦ЧњЧ—Ч”!

## вњ… ЧћЧ” Ч‘Ч“Ч§Ч Ч• Ч•ЧўЧ‘Ч“

### 1. Ч”Ч¤ЧЁЧЧ™Чќ Ч©ЧњЧљ ЧЄЧ§Ч™Ч Ч™Чќ вњ…
```
Email: itadmit@gmail.com
Environment: Production вњ…
Token received: 69208E8F4431CFB... вњ…
IsAuthenticated: true вњ…
Company: ЧЄЧ“ЧћЧ™ЧЄ ЧђЧ™Ч ЧЧЁЧђЧ§ЧЧ™Ч‘
```

### 2. Ч”Ч‘ЧўЧ™Ч” Ч©ЧЄЧ™Ч§Ч Ч•
**Ч”Ч‘ЧўЧ™Ч” Ч”ЧћЧ§Ч•ЧЁЧ™ЧЄ:** `Cannot read properties of undefined (reading 'createClientAsync')`

**Ч”ЧЎЧ™Ч‘Ч”:** ЧЎЧ¤ЧЁЧ™Ч™ЧЄ `soap` ЧњЧђ Ч ЧЧўЧ ЧЄ Ч Ч›Ч•Чџ Ч‘-Next.js App Router Ч‘Ч’ЧњЧњ Ч©Ч”Ч™Чђ CommonJS module.

**Ч”Ч¤ЧЄЧЁЧ•Чџ:** Ч©Ч™Ч Ч™Ч Ч• Чњ-**dynamic import**:
```typescript
// вќЊ ЧњЧ¤Ч Ч™ (ЧњЧђ ЧўЧ‘Ч“):
import soap from 'soap';

// вњ… ЧђЧ—ЧЁЧ™ (ЧўЧ•Ч‘Ч“!):
const soap = await import('soap');
```

## рџљЂ ЧђЧ™Чљ ЧњЧ”Ч©ЧЄЧћЧ© ЧўЧ›Ч©Ч™Ч•

### Ч©ЧњЧ‘ 1: Ч”ЧЄЧ—Ч‘ЧЁ Чњ-Invoice4U
1. ЧњЧљ Чњ-**Ч”Ч’Ч“ЧЁЧ•ЧЄ в†’ ЧђЧ™Ч ЧЧ’ЧЁЧ¦Ч™Ч•ЧЄ**
2. Ч’ЧњЧ•Чњ Чњ-**Invoice4U - Ч”Ч•Ч¦ЧђЧЄ ЧћЧЎЧћЧ›Ч™Чќ**
3. ЧћЧњЧђ ЧђЧЄ Ч”Ч¤ЧЁЧЧ™Чќ:
   - вњ‰пёЏ ЧђЧ™ЧћЧ™Ч™Чњ: `itadmit@gmail.com`
   - рџ”’ ЧЎЧ™ЧЎЧћЧ”: Ч”ЧЎЧ™ЧЎЧћЧ” Ч©ЧњЧљ
   - вњ… ЧЎЧћЧџ: **Ч©Ч™ЧћЧ•Ч© Ч‘ЧЎЧ‘Ч™Ч‘ЧЄ Ч™Ч™Ч¦Ч•ЧЁ (Production)**
4. ЧњЧ—ЧҐ ЧўЧњ **"Ч”ЧЄЧ—Ч‘ЧЁ Чњ-Invoice4U"**
5. ЧЄЧ§Ч‘Чњ Ч”Ч•Ч“ЧўЧ”: **"Ч”Ч¦ЧњЧ—Ч”! Ч”Ч—Ч™Ч‘Ч•ЧЁ Чњ-Invoice4U Ч”Ч•Ч©ЧњЧќ Ч‘Ч”Ч¦ЧњЧ—Ч”"** рџЋ‰

### Ч©ЧњЧ‘ 2: Ч‘Ч“Ч•Ч§ ЧђЧЄ Ч”Ч—Ч™Ч‘Ч•ЧЁ (ЧђЧ•Ч¤Ч¦Ч™Ч•Ч ЧњЧ™)
- ЧђЧ—ЧЁЧ™ Ч”Ч”ЧЄЧ—Ч‘ЧЁЧ•ЧЄ, ЧЄЧ•Ч›Чњ ЧњЧњЧ—Ч•ЧҐ ЧўЧњ **"рџ”Ќ Ч‘Ч“Ч•Ч§ Ч—Ч™Ч‘Ч•ЧЁ"**
- Ч–Ч” Ч™Ч‘Ч“Ч•Ч§ Ч©Ч”Ч—Ч™Ч‘Ч•ЧЁ ЧўЧ“Ч™Ч™Чџ Ч¤ЧўЧ™Чњ Ч•ЧЄЧ§Ч™Чџ

### Ч©ЧњЧ‘ 3: Ч”Ч•Ч¦Чђ ЧћЧЎЧћЧ›Ч™Чќ!
1. ЧњЧљ ЧњЧ“ЧЈ **ЧњЧ§Ч•Ч—Ч•ЧЄ** ЧђЧ• **ЧњЧ™Ч“Ч™Чќ**
2. ЧњЧ—ЧҐ ЧўЧњ ЧњЧ§Ч•Ч— ЧЎЧ¤Ч¦Ч™Ч¤Ч™
3. ЧњЧ—ЧҐ ЧўЧњ Ч”Ч›Ч¤ЧЄЧ•ЧЁ **"Ч”Ч•Ч¦Чђ ЧћЧЎЧћЧљ Invoice4U"** рџ“„
4. Ч‘Ч—ЧЁ ЧђЧЄ ЧЎЧ•Ч’ Ч”ЧћЧЎЧћЧљ:
   - рџ“‹ **Ч”Ч¦ЧўЧЄ ЧћЧ—Ч™ЧЁ** (InvoiceQuote)
   - рџ’° **Ч—Ч©Ч‘Ч•Чџ ЧўЧЎЧ§Ч”** (ProformaInvoice)
   - рџ§ѕ **Ч—Ч©Ч‘Ч•Ч Ч™ЧЄ ЧћЧЎ** (Invoice)
   - рџ§ѕвњ… **Ч—Ч©Ч‘Ч•Ч Ч™ЧЄ ЧћЧЎ Ч§Ч‘ЧњЧ”** (InvoiceReceipt)
5. ЧћЧњЧђ Ч¤ЧЁЧЧ™Чќ Ч•Ч”Ч¤ЧЁЧ™ЧЧ™Чќ
6. ЧњЧ—ЧҐ **"Ч¦Ч•ЧЁ ЧћЧЎЧћЧљ"**

Ч”ЧћЧЎЧћЧљ Ч™Ч™Ч•Ч•Ч¦ЧЁ Ч‘-Invoice4U Ч•Ч™Ч™Ч©ЧњЧ— ЧђЧ•ЧЧ•ЧћЧЧ™ЧЄ ЧњЧћЧ™Ч™Чњ Ч”ЧњЧ§Ч•Ч—! рџљЂ

## рџ“‚ Ч”Ч§Ч‘Ч¦Ч™Чќ Ч©Ч Ч•Ч¦ЧЁЧ•

### Backend (Node.js/API)
1. **`lib/invoice4u.ts`** - Ч”ЧњЧ•Ч’Ч™Ч§Ч” Ч©Чњ Ч”-SOAP client
2. **`lib/encryption.ts`** - Ч”Ч¦Ч¤Ч Ч” Ч•Ч¤ЧўЧ Ч•Ч— Ч©Чњ ЧЎЧ™ЧЎЧћЧђЧ•ЧЄ
3. **`app/api/integrations/invoice4u/route.ts`** - API ЧњЧ Ч™Ч”Ч•Чњ ЧђЧ™Ч ЧЧ’ЧЁЧ¦Ч™Ч”
4. **`app/api/integrations/invoice4u/documents/route.ts`** - API ЧњЧ™Ч¦Ч™ЧЁЧЄ ЧћЧЎЧћЧ›Ч™Чќ
5. **`app/api/integrations/invoice4u/test/route.ts`** - API ЧњЧ‘Ч“Ч™Ч§ЧЄ Ч—Ч™Ч‘Ч•ЧЁ

### Frontend (React/Next.js)
6. **`app/settings/integrations/page.tsx`** - ЧўЧћЧ•Ч“ Ч”Ч’Ч“ЧЁЧ•ЧЄ ЧђЧ™Ч ЧЧ’ЧЁЧ¦Ч™Ч•ЧЄ
7. **`components/dialogs/Invoice4UDialog.tsx`** - Ч“Ч™ЧђЧњЧ•Ч’ ЧњЧ”Ч•Ч¦ЧђЧЄ ЧћЧЎЧћЧ›Ч™Чќ
8. **`app/clients/[id]/page.tsx`** - Ч©Ч™ЧњЧ•Ч‘ Ч”Ч›Ч¤ЧЄЧ•ЧЁ Ч‘Ч“ЧЈ Ч”ЧњЧ§Ч•Ч—

### Database (Prisma)
9. **`prisma/schema.prisma`** - ЧЧ‘ЧњЧЄ `Integration` ЧњЧћЧЎЧ“ Ч ЧЄЧ•Ч Ч™Чќ

### Types
10. **`types/invoice4u.d.ts`** - TypeScript types

### Documentation
11. **`INVOICE4U_INTEGRATION.md`** - ЧЄЧ™ЧўЧ•Ч“ ЧћЧњЧђ
12. **`DEBUGGING_GUIDE.md`** - ЧћЧ“ЧЁЧ™Чљ Ч“Ч™Ч‘ЧђЧ’
13. **`INVOICE4U_TROUBLESHOOTING.md`** - Ч¤ЧЄЧЁЧ•Чџ Ч‘ЧўЧ™Ч•ЧЄ Ч Ч¤Ч•Ч¦Ч•ЧЄ

## рџ”ђ ЧђЧ‘ЧЧ—Ч”

Ч”ЧЎЧ™ЧЎЧћЧђЧ•ЧЄ ЧћЧ•Ч¦Ч¤Ч Ч•ЧЄ Ч‘ЧћЧЎЧ“ Ч”Ч ЧЄЧ•Ч Ч™Чќ Ч‘ЧђЧћЧ¦ЧўЧ•ЧЄ **AES-256-CBC**.

Ч›Ч“Ч™ ЧњЧ”Ч’Ч“Ч™ЧЁ ЧћЧ¤ЧЄЧ— Ч”Ч¦Ч¤Ч Ч”, Ч”Ч•ЧЎЧЈ Чњ-`.env` ЧђЧ• `.env.local`:
```bash
ENCRYPTION_KEY="your-secret-32-char-key-here"
```

## рџ§Є Ч‘Ч“Ч™Ч§Ч•ЧЄ Ч©ЧўЧ©Ч™Ч Ч•

### вњ… Ч‘Ч“Ч™Ч§Ч” 1: SOAP Connection
```bash
node test-invoice4u.js
вњ… SOAP client created successfully
вњ… Login SUCCESSFUL!
вњ… Token: 93C568B4142DFB9F...
вњ… IsAuthenticated: true
```

### вњ… Ч‘Ч“Ч™Ч§Ч” 2: API Integration
```
POST /api/integrations/invoice4u
вњ… Login successful! Token: 69208E8F4431CFB...
вњ… IsAuthenticated result: true
вњ… Integration saved to database
```

### вњ… Ч‘Ч“Ч™Ч§Ч” 3: Test Endpoint
```
GET /api/integrations/invoice4u/test
вњ… Connection successful
```

## рџ“Љ ЧћЧЎЧћЧ›Ч™Чќ Ч–ЧћЧ™Ч Ч™Чќ

| ЧЎЧ•Ч’ ЧћЧЎЧћЧљ | Ч§Ч•Ч“ | ЧЄЧ™ЧђЧ•ЧЁ |
|----------|-----|-------|
| Ч—Ч©Ч‘Ч•Ч Ч™ЧЄ ЧћЧЎ | `Invoice` (1) | Ч—Ч©Ч‘Ч•Ч Ч™ЧЄ ЧЁЧ’Ч™ЧњЧ” |
| Ч§Ч‘ЧњЧ” | `Receipt` (2) | Ч§Ч‘ЧњЧ” ЧўЧњ ЧЄЧ©ЧњЧ•Чќ |
| Ч—Ч©Ч‘Ч•Ч Ч™ЧЄ ЧћЧЎ Ч§Ч‘ЧњЧ” | `InvoiceReceipt` (3) | Ч—Ч©Ч‘Ч•Ч Ч™ЧЄ + Ч§Ч‘ЧњЧ” |
| Ч–Ч™Ч›Ч•Ч™ | `InvoiceCredit` (4) | ЧћЧЎЧћЧљ Ч–Ч™Ч›Ч•Ч™ |
| Ч—Ч©Ч‘Ч•Чџ ЧўЧЎЧ§Ч” | `ProformaInvoice` (5) | Ч—Ч©Ч‘Ч•Чџ ЧњЧњЧђ ЧћЧў"Чћ |
| Ч”Ч–ЧћЧ Ч” | `InvoiceOrder` (6) | Ч”Ч–ЧћЧ ЧЄ ЧЁЧ›Ч© |
| Ч”Ч¦ЧўЧЄ ЧћЧ—Ч™ЧЁ | `InvoiceQuote` (7) | Ч”Ч¦ЧўЧЄ ЧћЧ—Ч™ЧЁ ЧњЧњЧ§Ч•Ч— |
| ЧЄЧўЧ•Ч“ЧЄ ЧћЧ©ЧњЧ•Ч— | `InvoiceShip` (8) | ЧЄЧўЧ•Ч“ЧЄ ЧћЧ©ЧњЧ•Ч— |

## рџЋЇ Ч”Ч¦ЧўЧ“ Ч”Ч‘Чђ

ЧўЧ›Ч©Ч™Ч• ЧђЧ¤Ч©ЧЁ:
1. вњ… ЧњЧ”ЧЄЧ—Ч‘ЧЁ Чњ-Invoice4U ЧћЧ”Ч’Ч“ЧЁЧ•ЧЄ
2. вњ… ЧњЧ”Ч•Ч¦Ч™Чђ ЧћЧЎЧћЧ›Ч™Чќ Ч™Ч©Ч™ЧЁЧ•ЧЄ ЧћЧ“Ч¤Ч™ Ч”ЧњЧ§Ч•Ч—Ч•ЧЄ
3. вњ… ЧњЧ Ч”Чњ ЧђЧЄ Ч›Чњ Ч”ЧћЧЎЧћЧ›Ч™Чќ ЧћЧћЧ§Ч•Чќ ЧђЧ—Ч“
4. вњ… ЧњЧ©ЧњЧ•Ч— ЧћЧЎЧћЧ›Ч™Чќ ЧђЧ•ЧЧ•ЧћЧЧ™ЧЄ ЧњЧћЧ™Ч™Чњ Ч”ЧњЧ§Ч•Ч—

**Ч–Ч”Ч•! Ч”ЧђЧ™Ч ЧЧ’ЧЁЧ¦Ч™Ч” Ч¤Ч•ЧўЧњЧЄ Ч•ЧћЧ•Ч›Ч Ч” ЧњЧ©Ч™ЧћЧ•Ч©!** рџљЂ

---

## рџ’Ў ЧЧ™Ч¤Ч™Чќ

- Ч”ЧћЧЎЧћЧ›Ч™Чќ Ч Ч©ЧћЧЁЧ™Чќ Ч‘-Invoice4U Ч•ЧњЧђ Ч‘-CRM
- ЧђЧ¤Ч©ЧЁ ЧњЧЁЧђЧ•ЧЄ ЧђЧЄ Ч›Чњ Ч”ЧћЧЎЧћЧ›Ч™Чќ Ч‘-[dashboard Ч©Чњ Invoice4U](https://www.invoice4u.co.il)
- Ч”Ч›Ч¤ЧЄЧ•ЧЁ "Ч‘Ч“Ч•Ч§ Ч—Ч™Ч‘Ч•ЧЁ" Ч©Ч™ЧћЧ•Ч©Ч™ ЧњЧђЧ—ЧЁ ЧЄЧ§Ч•Ч¤Ч” ЧђЧЁЧ•Ч›Ч” Ч©Чњ Ч—Ч•ЧЎЧЁ Ч©Ч™ЧћЧ•Ч©
- ЧђЧ¤Ч©ЧЁ ЧњЧ”Ч•ЧЎЧ™ЧЈ ЧўЧ•Ч“ ЧЎЧ•Ч’Ч™ ЧћЧЎЧћЧ›Ч™Чќ Ч‘ЧўЧЄЧ™Ч“ ЧњЧ¤Ч™ Ч”Ч¦Ч•ЧЁЧљ

---

**ЧЄЧ•Ч“Ч” Ч©Ч”Ч™Ч™ЧЄ ЧЎЧ‘ЧњЧ Ч™! Ч Ч”Ч ЧЄЧ™ ЧњЧўЧ–Ч•ЧЁ ЧњЧљ ЧњЧ‘Ч Ч•ЧЄ ЧђЧЄ Ч”ЧђЧ™Ч ЧЧ’ЧЁЧ¦Ч™Ч” Ч”Ч–Ч•!** рџЋ‰

