הנה אפיון מלא ל-CRM מבוסס Next.js כ-SaaS (פוסטגרס, דוקר, RTL, Noto Sans Hebrew), כולל תיאור לכל מסך, זרימות, הרשאות, ו־API. הכל כתוב בראייה מודרנית עם דגש על UX נקי, חיבורים בין לידים/לקוחות/פרויקטים/תקציבים, וובּהוקים, אוטומציות ודוחות.

🧭 סיכום על: מה המערכת עושה

מערכת CRM מרובת-דיירים (Multi-Tenant) לניהול לידים → לקוחות → פרויקטים → משימות → תקציבים/צפי הכנסות.

Webhook לקליטת לידים/לקוחות ממערכות חיצוניות עם אבטחת API Key/HMAC.

Kanban למשימות ול־Pipeline מכירות.

דוחות צפי מול ביצוע, יחס המרה, מקורות לידים.

אוטומציות: טריגר → תנאים → אקשן.

סופר-אדמין (itadmit@gmail.com
, סיסמת Bootstrapping: 115599) עם מסכי הגדרות גלובליים (SMTP, טננטים, פיצ’רים).

אחסון קבצים מקומי (low-volume) בדוקר.

UI RTL, אייקונים React (lucide-react), פונט Noto Sans Hebrew.

🧱 תשתית וארכיטקטורה (גבוה)

Frontend: Next.js 15 (App Router), TypeScript, Tailwind, shadcn/ui, lucide-react, RTL.

Backend: Next.js API routes / Route Handlers, Nodemailer (Gmail SMTP).

DB: PostgreSQL + Prisma, הפרדה לפי companyId.

Auth: NextAuth (Credentials). אימייל סופר-אדמין מזוהה מה־ENV ליכולות ניהול גלובליות.

Docker: web + db; נפח uploads_data לקבצים.

Logs: webhook_logs, automation_logs, audit_logs.

Mail: Gmail SMTP (App Password), תבניות מייל.

Observability: מדדי latency ל־webhooks, counters בסיסיים.

🔐 תפקידי משתמשים (RBAC)

SUPER_ADMIN (גלובלי): רואה/מנהל טננטים, SMTP גלובלי, דגלי פיצ’רים.

ADMIN (ברמת חברה): כל ההגדרות של החברה, משתמשים, אינטגרציות.

MANAGER: ניהול צוות, הקצאות, דוחות.

USER: עבודה יומיומית (לידים/לקוחות/משימות) בהתאם להרשאות.

🗃️ מודלים עיקריים (DB, תמצית)

companies(id, name, plan, api_key, ... )

users(id, email, name, password, role, companyId)

leads(id, companyId, name, email, phone, source, status, tags[], ownerId, clientId?)

clients(id, companyId, name, email, phone, address, notes, ownerId)

projects(id, companyId, clientId, name, description, status, budget, progress, startDate, endDate)

tasks(id, companyId, projectId?, assigneeId?, title, description, status, position, dueDate, priority)

budgets(id, companyId, projectId?, clientId?, amount, expectedAt, status)

files(id, companyId, entityType, entityId, path, name, size)

webhook_logs(id, companyId, type, payload, statusCode, durationMs, createdAt)

automations(id, companyId, name, isActive, trigger, conditions, actions, createdBy)

automation_logs(id, automationId, status, payload, createdAt)

audit_logs(id, companyId, userId?, action, entityType, entityId, diff, createdAt)

pipelines(id, companyId, name, isDefault)

pipeline_stages(id, pipelineId, name, position, winProbability)

כל הטבלאות מכילות companyId (מלבד גלובליות ל-SUPER_ADMIN).

🖥️ מסכים (UI) — אפיון לכל מסך
0) כניסה / הרשמה / שחזור סיסמה

יעוד: אימות משתמשים ויצירת חברה חדשה למשתמש ראשון.
נתיב:

/login, /register, /forgot-password
פעולות:

כניסה עם אימייל/סיסמה.

הרשמה: name, email, password, companyName. יוצר Company + User (ADMIN). אם האימייל = ADMIN_EMAIL → SUPER_ADMIN.

שחזור: שליחת לינק איפוס (Future).
ולידציה: אימייל תקין, סיסמה ≥ 8 תווים, rate limit.
מצבי ריק: כפתור “נסה דמו”.
הרשאות: Public.

1) Onboarding לחברה חדשה (Wizard)

יעוד: 3-4 צעדים: פרטי חברה, צוות, SMTP (אופציונלי), יצירת Pipeline ברירת מחדל.
נתיב: /onboarding (למשתמשי ADMIN בחברה חדשה).
פעולות: שמירת פרטים, יצירת סטייג’ים ב־Pipeline: “חדש → יצירת קשר → פגישה → הצעה → סגור”.
ולידציה: חובה שם חברה, לפחות 3 סטייג’ים.
הרשאות: ADMIN.

2) דשבורד ראשי

יעוד: מבט-על: לידים חדשים, משימות קרובות, צפי הכנסות, מקורות לידים.
נתיב: /dashboard
רכיבים:

KPI Cards: לידים (7 ימים), לקוחות פעילים, פרויקטים פתוחים, צפי חודש נוכחי.

גרפים: “צפי מול ביצוע” (חודשי), “מקורות לידים”, “יחס המרה בפייפליין”.

“המשימות שלי היום”.
פעולות: קישורים לעמודים הרלוונטיים.
הרשאות: USER+.

3) לידים — רשימה

יעוד: חיפוש/סינון/מיון לידים; פעולות אצווה.
נתיב: /leads
שדות עיקריים: שם, אימייל/טלפון, מקור, סטטוס, בעלים (Owner), תגים, תאריך.
פיצ’רים:

סינון לפי סטטוס/מקור/בעלים/תאריך.

Bulk assign / שינוי סטטוס / המרה ללקוח.

יבוא CSV.
API: GET /api/leads?filters, PATCH /api/leads/bulk.
הרשאות: USER+ (ראה מדיניות בעלות).

4) לידים — Pipeline (Kanban)

יעוד: הזזת לידים בין שלבי המכירה ב-Drag&Drop.
נתיב: /leads/pipeline
רכיבים: עמודות לפי pipeline_stages (ניתן להתאמה לכל חברה).
פעולות: גרירה בין עמודות → stage מתעדכן, חישוב Win Probability.
הרשאות: USER+.

5) כרטיס ליד (Lead Detail)

יעוד: תצוגה מלאה של ליד.
נתיב: /leads/:id
בלוקים: פרטים, תגים, סטטוס/שלב, בעלים, פעולות מהירות (שיחה/מייל), קבצים, Timeline (שינויים/שיחות/מיילים/משימות/אוטומציות), משימות קשורות, הצעות/תקציבים קשורים.
פעולות: המרה ללקוח (יוצר clients + עדכון lead.clientId).
הרשאות: USER+; עריכה לפי בעלות/תפקיד.

6) לקוחות — רשימה

יעוד: ניהול לקוחות.
נתיב: /clients
שדות: שם, איש קשר, טלפון, אימייל, סטטוס, בעלים, תאריך יצירה.
פיצ’רים: סינון חכם, ייבוא/ייצוא.
הרשאות: USER+.

7) כרטיס לקוח (Client Detail)

יעוד: מרכז הלקוח.
נתיב: /clients/:id
בלוקים: פרטי חברה/איש קשר, פרויקטים, הצעות/תקציבים, משימות, קבצים, Timeline, אנשי צוות מטעם הספק, אינטגרציות (לדוג’ PayPlus לקוח).
פעולות: יצירת פרויקט חדש, הוספת תקציב/הצעה, שליחת מייל מתבנית.
הרשאות: USER+.

8) פרויקטים — רשימה

יעוד: ניהול פרויקטים.
נתיב: /projects
שדות: לקוח, שם, סטטוס, אחוז התקדמות, תאריכים, מנהל פרויקט.
סינון: לפי סטטוס/לקוח/אחראי.
הרשאות: USER+.

9) כרטיס פרויקט (Project Detail)

יעוד: ניהול מלא של פרויקט.
נתיב: /projects/:id
בלוקים: תקציב מתוכנן/ביצוע בפועל, לוח משימות פנימי (Kanban קטן לפרויקט), milestones, קבצים, Timeline, אנשים מעורבים, הצעות/חשבוניות קשורות.
פעולות: שינוי סטטוס, עדכון התקדמות, יצירת תקציב/משימה.
הרשאות: USER+.

10) משימות — לוח Kanban

יעוד: ניהול משימות בסגנון טרלו.
נתיב: /tasks/board
עמודות: To Do / In Progress / Done (ניתן להרחבה).
כרטיס משימה: כותרת, תיאור, Due date, עדיפות, אחראי, פרויקט קשור, תגים, צ׳ק-ליסט, קבצים.
הרשאות: USER+.

11) המשימות שלי (רשימה)

יעוד: פוקוס אישי.
נתיב: /tasks/my
מיון: לפי דדליין/עדיפות.
פעולות: סימון “בוצע”, דחייה, הערות.
הרשאות: USER+.

12) תקציבים / הצעות מחיר

יעוד: ניהול צפי הכנסות והצעות.
נתיב: /budgets (רשימה), /budgets/:id (כרטיס).
שדות: סכום, לקוח/פרויקט, expectedAt, סטטוס (PENDING/WON/LOST/PAID).
פיצ’רים: הפקת PDF (מאוחר יותר), שליחה במייל מתבנית.
הרשאות: USER+; עריכה: MANAGER/ADMIN.

13) דוחות & אנליטיקות

יעוד: החלטות ניהוליות.
נתיב: /reports
כרטיסים/גרפים:

צפי מול ביצוע (חודשי/רבעוני).

מקורות לידים (Pie/Bar).

יחס המרה בפייפליין (Funnel).

ביצועי צוות (לידים שטופלו/נסגרו).
פילטרים: תאריכים, בעלים, מקור, לקוח.
ייצוא: CSV/PDF.
הרשאות: MANAGER+ (תצוגה מסוימת ל-USER על עצמו).

14) תקשורת (מיילים) — בסיס

יעוד: שליחת אימיילים מהמערכת + תבניות.
נתיב: /communications/email
פיצ’רים: שליחת מייל ללקוח/ליד עם Template, צפייה בלוג מינימלי (“נשלח/נכשל”).
הערה: אינטגרציה דו-כיוונית ל-Gmail API — Roadmap.
הרשאות: USER+.

15) קבצים

יעוד: ניהול קבצים מצורפים לכל כרטיס (ליד/לקוח/פרויקט/משימה).
נתיב: בחלונית צד ב-Entity או /files כללית.
פעולות: העלאה, הורדה, מחיקה, קישור ל־entity.
הרשאות: USER+.

16) אינטגרציות & Webhooks

יעוד: ניהול מפתחות API, endpoints, לוגים.
נתיב: /settings/integrations
בלוקים:

Incoming Webhook: Leads – מציג URL לדייר (כולל companyId או X-API-KEY).

Security: יצירת/רוטציית API Key, אימות HMAC אופציונלי.

Webhook Logs – פילטר לפי סטטוס/תאריך, צפייה ב-payload/response.
הרשאות: ADMIN+.

דגם Webhook מומלץ (עם API Key):

POST /api/webhooks/leads
Headers:
  Content-Type: application/json
  X-API-KEY: <company_api_key>
Body:
{
  "name": "John Doe",
  "email": "john@example.com",
  "phone": "+972501234567",
  "source": "Facebook Ads",
  "tags": ["landing-1","summer"]
}


תגובות אפשריות:

201 { id, status: "created" }

409 { reason: "duplicate" } (אם מוגדר למנוע כפילויות תוך X ימים)

400 ולידציה.

17) אוטומציות (Automation Builder)

יעוד: להגדיר טריגרים ותסריטים.
נתיב: /automations
UI: רשימה + עורך Flow בסיסי (טבלה פשוטה בשלב ראשון).
Trigger לדוגמה:

on_lead_created, on_lead_stage_changed, on_budget_status_changed, daily_at_09:00.
Conditions: שדות (source=Facebook, amount>1000, owner=UserX).
Actions: שליחת מייל, יצירת משימה, עדכון סטטוס, פינג ל-Webhook חיצוני.
הרשאות: ADMIN/MANAGER.

18) צוות והרשאות

יעוד: ניהול משתמשי החברה.
נתיב: /settings/team
פעולות: הוספת משתמש (הזמנה במייל), שינוי role, ניהול בעלות על לידים.
הרשאות: ADMIN.

19) הגדרות חברה (Company)

יעוד: פרטי חברה, ברנדינג, ברירת מחדל ל-Pipeline/Stages, פורמט תאריכים/מטבע, SLA.
נתיב: /settings/company
הרשאות: ADMIN.

20) הגדרות SMTP

יעוד: הגדרת Gmail SMTP (ברמת חברה או ברמת מערכת).
נתיב: /settings/smtp
שדות: host, port, secure, user, app-password, from.
בדיקה: כפתור “שליחת מייל בדיקה”.
הרשאות: ADMIN; SUPER_ADMIN יכול להגדיר ברירת מחדל גלובלית.

21) יבוא/ייצוא

יעוד: CSV ל-Leads/Clients/Projects/Tasks/Budgets.
נתיב: /settings/import-export
פיצ’רים: מיפוי עמודות, זיהוי כפילויות לפי אימייל/טלפון, דוח טעויות.
הרשאות: ADMIN/MANAGER.

22) התראות (Notifications)

יעוד: מרכז התראות באפליקציה + אימיילים.
נתיב: מגש עליון (bell) + /notifications
אירועים: משימה תכופה, ליד חדש, שינוי סטטוס.
הרשאות: USER+.

23) Audit Log

יעוד: שקיפות ותחקור.
נתיב: /settings/audit-log
רשימה: מי עשה מה, על איזה Entity, מה השתנה (diff), מתי.
הרשאות: ADMIN/MANAGER (קריאה), SUPER_ADMIN (גלובלי לכל החברות).

24) מסכי סופר-אדמין (גלובלי)

יעוד: תפעול מערכת ה-SaaS.
נתיב: /superadmin/*
תתי-מסכים:

Tenants: רשימת חברות, מצב, plan, צריכה (מס’ משתמשים/שטח קבצים).

Global SMTP Defaults

Feature Flags / Plans (הפעלת מודולים לפי חבילה)

System Health (בדיקות חיבור DB/SMTP/דיסק).
הרשאות: SUPER_ADMIN בלבד.

🔌 API עיקריים (תמצית)
Auth

POST /api/auth/register → יצירת חברה+משתמש; הפיכת SUPER_ADMIN אם האימייל מתאים.

POST /api/auth/login (מטופל ב-NextAuth).

POST /api/auth/forgot-password (Roadmap).

Leads

GET /api/leads

POST /api/leads

PATCH /api/leads/:id

POST /api/leads/:id/convert-to-client

POST /api/leads/import (CSV)

Webhook In: POST /api/webhooks/leads (עם X-API-KEY)

Clients / Projects / Tasks / Budgets

REST CRUD מלא, כולל פעולות ייעודיות (למשל PATCH /api/tasks/:id/move ל-Kanban).

Files

POST /api/files/upload (multipart), GET /api/files/:id/download

Automations

GET/POST /api/automations

POST /api/automations/:id/test

Logs: GET /api/automations/:id/logs

Reports

GET /api/reports/revenue-forecast?from=&to=

GET /api/reports/leads-sources

GET /api/reports/pipeline-funnel

Settings

Company: GET/PATCH /api/settings/company

SMTP: GET/PATCH /api/settings/smtp + POST /api/settings/smtp/test

Team: GET/POST/PATCH /api/settings/team

Integrations: GET/PATCH /api/settings/integrations (API Key reset)

✅ ולידציות, ריק, שגיאות

Empty States בכל מסך עם “צור X ראשון שלך”.

Validation server + client (Zod/Valibot).

שגיאות: טוסטים ידידותיים; ב־Webhook — החזרת סיבה פרטנית (duplicate, invalid_phone, missing_name).

Rate Limit ל־webhooks.

Idempotency ל־webhooks (Header Idempotency-Key) למניעת כפילויות.

📈 ביצועים ונגישות

טבלאות וירטואליות (infinite scroll) ברשימות גדולות.

אינדקסים ב-DB על companyId, status, ownerId, createdAt.

נגישות: מקשי מקלדת, ARIA, קונטרסט.

RTL מלא + Noto Sans Hebrew.

🗺️ זרימות עיקריות (Flows)
A) ליד נכנס בוובּהוק

מקור שולח → POST /api/webhooks/leads + X-API-KEY.

ולידציה + בדיקת כפילויות.

יצירה ב-DB + כתיבת log.

הפעלת אוטומציות: שלח מייל לנציג, צור משימה follow-up.

התראה למשתמשים הרלוונטיים.

B) המרת ליד ללקוח

בלחיצה בכרטיס ליד: “המר ללקוח”.

יצירת client אם לא קיים + קישור הליד אליו.

הצעה לפתוח פרויקט + משימת follow-up.

C) צפי הכנסות

מנהל פרויקט מייצר budget עם סכום ותאריך צפוי.

בדשבורד/דוחות — גרף חודשי sum(amount by expectedAt) + סטטוס בפועל.

🧩 מה חסר ב-MVP לעומת CRM “מקצועי”? (Roadmap קצר)

דו-כיווני אימייל מלא (Gmail API), תיבות נכנסות, מעקב פתיחות/קליקים.

שיחות/WhatsApp רשמיות (Twilio / Meta WhatsApp Business API).

בוטים/טפסים חכמים.

תמחור/חיוב SaaS (Stripe/PayPlus) לתוכניות/חבילות.

שיתופי פעולה בין חברות (Accounts) ו-CRM B2B מורכב (ריבוי אנשי קשר ללקוח).

Marketplace של אינטגרציות.

הרשאות מפורטות לפי שדה/Entity (ACL מתקדם).

🧪 קריטריוני קבלה (DoD) ל-MVP

 הרשמה/כניסה, יצירת חברה ו-Pipeline ברירת מחדל.

 דשבורד עם KPI + 2 גרפים.

 לידים: טבלה + Pipeline + כרטיס + המרה ללקוח.

 לקוחות: טבלה + כרטיס.

 פרויקטים: טבלה + כרטיס.

 משימות: Kanban + “המשימות שלי”.

 תקציבים: טבלה + כרטיס, “צפי מול ביצוע” בסיסי.

 Webhook Leads + Logs + API Key per company.

 Automations: טריגר on_lead_created → Action send_email/create_task.

 SMTP עובד (בדיקת שליחה).

 קבצים: העלאה וצירוף ל-Entity.

 Audit Log בסיסי לשינויים מרכזיים.

🎨 קווים מנחים לעיצוב

RTL מלא; פונט Noto Sans Hebrew.

צבעי בסיס בהירים, קלפים עגולים, צל קל, תתי-כותרות אפורות.

אייקונים lucide-react (לידים: UserPlus, לקוחות: Users, פרויקטים: FolderKanban, משימות: CheckSquare, תקציבים: Coins, דוחות: BarChart3, אינטגרציות: Plug, אוטומציות: Workflow, הגדרות: Settings).

Empty states עם CTA ברור.




הנה עדכון מלא לאפיון הקיים, עם סעיף חדש של "תהליך העבודה הטבעי" ועם שינוי ארכיטקטוני שמתמקד בכך שעמוד הלקוח מרכז את כל הפעילות: לידים → לקוח → פרויקטים → משימות.

🔄 תהליך העבודה הטבעי (Workflow Logic)
1. ליד פונה אלינו

מקור: טופס באתר, פרסום בפייסבוק, Typebot, שיחה, או Webhook.

תהליך:

ה־Webhook או המשתמש יוצר רשומה ב־leads.

הליד מקבל סטטוס ראשוני: חדש.

נציג מוגדר כ־Owner (אוטומטי או ידני).

נוצרה משימה אוטומטית: “צור קשר עם הליד”.

בממשק הלידים ניתן לשנות סטטוס (בטיפול / סגור / הפך ללקוח).

2. המרה ללקוח

פעולה מתוך כרטיס הליד → כפתור “המר ללקוח”.

נוצרת רשומת client חדשה אם לא קיימת.

lead.clientId מתעדכן.

כל ההיסטוריה של הליד (שיחות, הערות, קבצים) עוברת ללקוח.

אוטומציה אפשרית: שליחת מייל “ברוך הבא” + יצירת משימת פתיחה.

3. הקמת פרויקט ללקוח

בכל כרטיס לקוח מופיע אזור “פרויקטים של הלקוח”.

בלחיצה “+ פרויקט חדש” נפתחת חלונית עם:

שם פרויקט (ברירת מחדל: שם הלקוח)

תיאור / תאריכים / תקציב משוער

אחוז התקדמות (ברירת מחדל 0%)

הנתונים נשמרים בטבלת projects.

הערה חשובה: מאחר ובדרך כלל יש רק פרויקט אחד, ה־UI מתוכנן כך שבלחיצה על לקוח רואים מייד את כרטיס הפרויקט הראשי — בלי לעבור לעמוד נפרד.

4. משימות תחת הפרויקט

בכל פרויקט יש אזור “משימות” — Kanban קטן או רשימה.

משימות קשורות לפרויקט (ולכן גם ללקוח).

כל משימה כוללת:

כותרת, אחראי, דדליין, תיאור, סטטוס, הערות.

פעולות מהירות: הוספה / גרירה / סימון כהושלמה.

ניתן להוסיף משימות גם ישירות מהכרטיס הראשי של הלקוח (ללא מעבר למסך אחר).

5. מעקב ותקשורת

מתוך עמוד הלקוח רואים הכול:

פרטי הלקוח

פרויקט(ים)

משימות

קבצים

תקציבים

Timeline של כל הפעולות

גישה זו יוצרת CRM ממוקד לקוח — כל היסטוריית הקשר עם אותו לקוח נמצאת במקום אחד, עם הפרויקט והמשימות שלו.

🧭 עדכון מבני בממשק (בהתאם לתהליך)
רכיב	שינוי עיקרי	הסבר
לקוחות (Clients)	הופך למסך מרכזי	כל הלקוחות, עם תצוגת סיכום של פרויקט ומשימות.
פרויקטים (Projects)	מוסתר מהתפריט הראשי, מוצג כתת־מודול	ניגשים אליהם דרך הלקוח בלבד.
משימות (Tasks)	מתפקדות גם דרך כרטיס הלקוח	משימות מוצגות בטאב של הלקוח וקשורות אוטומטית לפרויקט שלו.
לידים (Leads)	נשארים מסך עצמאי	תהליך טרום־לקוח, כולל המרה.
דוחות (Reports)	מתמקדים במעבר לידים→לקוחות→פרויקטים	מאפשר למדוד שלבי מעבר.
🧩 מבנה כרטיס לקוח מעודכן
עמוד: /clients/:id

אזורי תוכן:

Header:

שם הלקוח, איש קשר, סטטוס, תגים.

כפתורי פעולה מהירים: “ערוך”, “צור פרויקט”, “שלח מייל”, “צור משימה”.

Tabs / אזורים פנימיים:

🗂️ סקירה (Overview): תקציר פרויקט, התקדמות, סכום צפוי.

📁 פרויקטים: טבלה או כרטיס יחיד (לפי הכמות), עם סטטוס ואחוזי ביצוע.

✅ משימות: Kanban קטן (To Do / In Progress / Done).

💰 תקציבים: סכום צפוי מול בפועל.
nsta
📎 קבצים: העלאה/צפייה/מחיקה.

📈 Timeline: שינויים, מיילים, הערות, פעולות אוטומטיות.

Sidebar (ימני):

פרטי לקוח.

אנשי קשר משניים (אם קיימים).

פעולות מהירות (יצירת משימה, שליחת מייל, הוספת הערה).

🧠 יתרונות העיצוב הזה

✅ זרימה טבעית — ליד → לקוח → פרויקט → משימות.
✅ פחות מעבר בין עמודים — ניהול “הכול במקום אחד”.
✅ מתאימים למודלים של שירותים (ולא מוצרי SaaS טהורים).
✅ מאפשר דשבורד אנליטי פשוט: סה״כ לידים שהפכו ללקוחות פעילים.
✅ חוסך כפילויות בין טבלאות ומקטין עומס UI.

